<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>留言板 - sodous-s.github.io</title>
    <style>
        :root {
            --primary-color: #4285f4;
            --input-bg: #f8f9fa;
            --input-border: #dadce0;
            --author-badge: #fbbc04;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-container {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            font-size: 16px;
            background-color: var(--input-bg);
            color: #202124;
            box-sizing: border-box;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #3367d6;
        }
        
        .messages-container {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .message {
            border-bottom: 1px solid #eee;
            padding: 20px 0;
        }
        
        .message:last-child {
            border-bottom: none;
        }
        
        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .author {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .author-badge {
            background-color: var(--author-badge);
            color: #202124;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
        }
        
        .timestamp {
            color: #70757a;
            font-size: 14px;
            margin-left: auto;
        }
        
        .content {
            color: #202124;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #70757a;
        }
        
        .error {
            color: #ea4335;
            padding: 10px;
            background: #fce8e6;
            border-radius: 4px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>留言板</h1>
    
    <div class="form-container">
        <div class="form-group">
            <label for="nickname">昵称:</label>
            <input type="text" id="nickname" placeholder="请输入您的昵称">
        </div>
        
        <div class="form-group">
            <label for="content">留言内容:</label>
            <textarea id="content" placeholder="请输入您的留言..."></textarea>
        </div>
        
        <button id="submit-btn">提交留言</button>
        <div id="error-message" class="error" style="display: none;"></div>
    </div>
    
    <div class="messages-container">
        <h2>所有留言</h2>
        <div id="messages-list">
            <div class="loading">正在加载留言...</div>
        </div>
    </div>

    <script>
        // 密码验证
        const AUTHOR_PASSWORD = "wesd吞吞吐吐asdtyghbn";
        
        // GitHub仓库信息
        const REPO_OWNER = 'sodous-s';
        const REPO_NAME = 'sodous-s.github.io';
        
        // DOM元素
        const nicknameInput = document.getElementById('nickname');
        const contentInput = document.getElementById('content');
        const submitBtn = document.getElementById('submit-btn');
        const errorMessage = document.getElementById('error-message');
        const messagesList = document.getElementById('messages-list');
        
        // 检查是否是作者
        function isAuthor(nickname, password) {
            return nickname === '王艺轩' && password === AUTHOR_PASSWORD;
        }
        
        // 创建GitHub Issue链接
        function createIssueUrl(nickname, content) {
            const title = `留言: ${nickname.substring(0, 20)}${nickname.length > 20 ? '...' : ''}`;
            const body = `**昵称**: ${nickname}\n\n**留言内容**:\n${content}`;
            
            return `https://github.com/${REPO_OWNER}/${REPO_NAME}/issues/new?` + 
                   `title=${encodeURIComponent(title)}&` +
                   `body=${encodeURIComponent(body)}&` +
                   `labels=留言`;
        }
        
        // 获取留言
        async function fetchMessages() {
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/issues?labels=留言`
                );
                
                if (!response.ok) {
                    throw new Error('获取留言失败');
                }
                
                const issues = await response.json();
                displayMessages(issues);
            } catch (error) {
                messagesList.innerHTML = `<div class="error">错误: ${error.message}</div>`;
            }
        }
        
        // 显示留言
        function displayMessages(issues) {
            if (issues.length === 0) {
                messagesList.innerHTML = '<div class="message">暂无留言</div>';
                return;
            }
            
            messagesList.innerHTML = '';
            
            issues.forEach(issue => {
                const messageElement = document.createElement('div');
                messageElement.className = 'message';
                
                // 解析昵称和内容
                const bodyLines = issue.body.split('\n');
                const nicknameLine = bodyLines.find(line => line.startsWith('**昵称**:'));
                const contentStartIndex = bodyLines.findIndex(line => line.startsWith('**留言内容**:'));
                
                const nickname = nicknameLine ? nicknameLine.replace('**昵称**:', '').trim() : '匿名';
                const content = contentStartIndex !== -1 ? 
                    bodyLines.slice(contentStartIndex + 1).join('\n').trim() : 
                    issue.body;
                
                // 格式化时间
                const date = new Date(issue.created_at);
                const formattedDate = `${date.getFullYear()}-${(date.getMonth()+1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                
                messageElement.innerHTML = `
                    <div class="message-header">
                        <span class="author">${nickname}</span>
                        ${isAuthor(nickname, AUTHOR_PASSWORD) ? '<span class="author-badge">网站作者</span>' : ''}
                        <span class="timestamp">${formattedDate}</span>
                    </div>
                    <div class="content">${content}</div>
                `;
                
                messagesList.appendChild(messageElement);
            });
        }
        
        // 提交留言
        submitBtn.addEventListener('click', () => {
            const nickname = nicknameInput.value.trim();
            const content = contentInput.value.trim();
            
            // 重置错误消息
            errorMessage.style.display = 'none';
            
            // 验证输入
            if (!nickname) {
                showError('请输入昵称');
                return;
            }
            
            if (!content) {
                showError('请输入留言内容');
                return;
            }
            
            // 特殊处理作者
            if (nickname === '王艺轩') {
                const password = prompt('请输入密码验证身份:');
                if (!password || !isAuthor(nickname, password)) {
                    showError('密码错误或已取消');
                    return;
                }
            }
            
            // 创建GitHub Issue
            window.open(createIssueUrl(nickname, content), '_blank');
            
            // 清空表单
            nicknameInput.value = '';
            contentInput.value = '';
            
            // 提示用户
            alert('留言已提交！请在新打开的GitHub页面中点击"Submit new issue"完成留言。提交后刷新本页面查看您的留言。');
        });
        
        // 显示错误
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }
        
        // 页面加载时获取留言
        window.addEventListener('DOMContentLoaded', fetchMessages);
    </script>
</body>
</html>
